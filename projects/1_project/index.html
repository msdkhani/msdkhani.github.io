<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/spike_detection.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Spike Detection Process" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

    </div>
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/feature_extraction.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Feature Extraction Process" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

    </div>
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/clustering.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Clustering Process" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

    </div>
</div>

<div class="caption">
    The PyWaveClus pipeline consists of three main steps: spike detection, feature extraction, and clustering.
</div>

<h4>Overview</h4>
<p>
    <strong>PyWaveClus</strong> is a Python package designed to analyze electrophysiological recordings. In neuroscience, spikes—brief electrical discharges from neurons—encode essential information about brain function. 
    However, detecting and interpreting these spikes in large datasets can be complex due to noise and overlapping signals.
</p>
<p>
    This package streamlines spike sorting by providing an automated pipeline that includes:
</p>
<ul>
    <li>
<strong>Spike Detection:</strong> Identifying neural spikes from noisy signals.</li>
    <li>
<strong>Feature Extraction:</strong> Transforming spike waveforms into numerical features for clustering.</li>
    <li>
<strong>Clustering:</strong> Grouping spikes likely originating from the same neuron.</li>
</ul>

<hr>

<h5>1. Spike Detection</h5>
<p>
    Neural spikes are often buried in noise, making robust detection essential. In PyWaveClus, spike detection relies on **wavelet-based thresholding**. 
    The signal is first filtered, and then a **wavelet transform** is applied to isolate spikes based on transient changes in voltage.
</p>

<h6>Concept:</h6>
<ul>
    <li>
<strong>Filtering:</strong> Reduces noise by applying bandpass filters (e.g., 2 Hz to 4 kHz) to remove unwanted frequencies.</li>
    <li>
<strong>Wavelet Transform:</strong> Decomposes the signal into multiple frequency bands, enhancing the identification of sharp voltage changes characteristic of spikes.</li>
    <li>
<strong>Thresholding:</strong> Spikes are detected by comparing the wavelet coefficients to a predefined threshold.</li>
</ul>

<h6>Code Implementation:</h6>
<pre><code class="language-python">
import pywaveclus.spike_detection as sd

# Step 1: Load your electrophysiological recording (using SpikeInterface)
recording = ...            # Raw recording
recording_bp2 = ...        # Bandpass filtered at 2 Hz
recording_bp4 = ...        # Bandpass filtered at 4 kHz

# Step 2: Detect spikes
spike_detection_results = sd.detect_spikes(recording, recording_bp2, recording_bp4)

# Step 3: Extract waveforms of detected spikes
spikes_waveforms = sd.extract_waveforms(spike_detection_results, recording_bp2)
</code></pre>

<p>
    The output includes the timestamps and channels where spikes were detected. The extracted waveforms are segmented for further analysis.
</p>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/spike_waveforms.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Detected Spike Waveforms" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

    </div>
</div>

<hr>

<h5>2. Feature Extraction</h5>
<p>
    Once spikes are detected, we need to extract numerical features to represent their key characteristics. PyWaveClus supports two main methods:
</p>
<ul>
    <li>
<strong>Haar Wavelets:</strong> Efficiently captures local variations in the waveform shape.</li>
    <li>
<strong>Principal Component Analysis (PCA):</strong> Reduces the dimensionality of the waveform data while preserving the most important features.</li>
</ul>

<h6>How It Works:</h6>
<p>
    The spike waveform is isolated and then transformed into features. These features are compact and informative, making clustering more efficient and accurate.
</p>

<h6>Code Implementation:</h6>
<pre><code class="language-python">
import pywaveclus.feature_extraction as fe

# Step 4: Extract features from spike waveforms
features = fe.feature_extraction(spikes_waveforms)
</code></pre>

<p>
    The extracted features are ready to be used for clustering. Researchers can also choose between different feature extraction methods based on their analysis needs.
</p>

<div class="row justify-content-sm-center">
    <div class="col-sm-8 mt-3 mt-md-0">
        <figure>

  <picture>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/feature_visualization.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Feature Space Visualization" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

    </div>
</div>

<hr>

<h5>3. Clustering</h5>
<p>
    Neural recordings often capture spikes from multiple neurons on a single electrode. Clustering helps distinguish spikes generated by different neurons, enabling researchers to study individual neuron activity.
</p>
<p>
    PyWaveClus uses the **Super Paramagnetic Clustering (SPC)** algorithm, which is particularly effective for high-dimensional data. It automatically identifies clusters without requiring strict assumptions about cluster shape.
</p>

<h6>How It Works:</h6>
<ul>
    <li>
<strong>Feature Similarity:</strong> The algorithm groups spikes based on the similarity of their features.</li>
    <li>
<strong>Temperature Parameter:</strong> Clusters are formed by adjusting a temperature parameter, which influences how tightly points are grouped.</li>
    <li>
<strong>Cluster Assignment:</strong> Each spike is labeled with a cluster ID representing the neuron it likely originated from.</li>
</ul>

<h6>Code Implementation:</h6>
<pre><code class="language-python">
import pywaveclus.clustering as clu

# Step 5: Perform clustering on the extracted features
labels, metadata = clu.SPC_clustering(features)
</code></pre>

<p>
    The output includes cluster labels and metadata (e.g., cluster sizes and temperature maps). This allows researchers to analyze each neuron's activity separately.
</p>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/clustering_results.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Clustering Output" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

    </div>
</div>

<hr>

<h4>Running the Full Pipeline</h4>
<p>
    To simplify the workflow, PyWaveClus offers the <code>spike_sorting_pipeline</code> function, which automates spike detection, feature extraction, and clustering.
</p>

<h6>Code Implementation:</h6>
<pre><code class="language-python">
from pywaveclus.waveclus import spike_sorting_pipeline

OUTPUT_FOLDER = '/'
PROJECT_NAME = 'test'

def main():
    bundle_dict = ...
    recording = ...
    recording_bp2 = ...
    recording_bp4 = ...
    #Run the full pipeline
    spike_sorting_pipeline(
        recording, 
        recording_bp2, 
        recording_bp4, 
        bundle_dict,
        artifact_removal=True,
        save_dir=f'{OUTPUT_FOLDER}/{PROJECT_NAME}/'
    )

if __name__ == '__main__':
    main()
</code></pre>

<hr>

<h4>Summary</h4>
<p>
    PyWaveClus is a powerful and modular tool for spike sorting in neuroscience research. It combines advanced detection, feature extraction, and clustering techniques to streamline the analysis of large-scale neural data. By integrating with <strong>SpikeInterface</strong>, the package supports various data formats and enhances reproducibility.
</p>
</body></html>
